<!doctype html>
<html lang="en">
  <head>
    <title>Friend Finder</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Russo+One" rel="stylesheet">
    <style>
      body { background-color:rgb(25, 25, 175); }
      .row { margin: 0 auto; }
      a, a:hover   { text-decoration: none !important; color : inherit; }
      select:hover, .btn:hover { cursor: pointer; }
      .question         { padding: 15px 0 15px 15px; }
      .invalid-feedback { color: rgb(155, 0, 0); }
      .ends {
        background-color: rgb(90, 0, 205);
        color:rgb(155, 155, 255);
        border: 4px solid rgb(0, 32, 120);
        font-family: 'Russo One', sans-serif;
      }
      .questions {
        background: rgb(15, 75, 250); /* For browsers that do not support gradients */
        background: -webkit-linear-gradient(left top, rgb(90, 0, 205), rgb(15, 75, 250)); /* For Safari 5.1 to 6.0 */
        background: -o-linear-gradient(bottom right, rgb(90, 0, 205), rgb(15, 75, 250)); /* For Opera 11.1 to 12.0 */
        background: -moz-linear-gradient(bottom right, rgb(90, 0, 205), rgb(15, 75, 250)); /* For Firefox 3.6 to 15 */
        background: linear-gradient(to bottom right,rgb(15, 75, 250), rgb(0, 205, 205)); /* Standard syntax */
        border-left: 4px solid rgb(0, 32, 120);
        border-right: 4px solid rgb(0, 32, 120);
        color:rgb(255, 255, 255);
        max-height: 550px;
        overflow: auto;
      }
      /* Custom scroll bar */
      .scroll::-webkit-scrollbar-track {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        border-radius: 10px;
        background-color: #F5F5F5;
      }
      .scroll::-webkit-scrollbar {
        width: 20px;
        background-color: rgb(3,181,213);
      }
      .scroll::-webkit-scrollbar-thumb {
        border-radius: 10px;
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
        box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        background-color: rgb(90, 0, 205);
      }
      /* Modal */
      .modal-content { border: 2px solid rgb(0, 32, 120); }
      .modal-body { 
        background-color: rgb(7,146,225);
        color:rgb(255, 255, 255);
        border-left: 2px solid rgb(0, 32, 120);
        border-right: 2px solid rgb(0, 32, 120);
      }
      .modal-header, .modal-footer {
        font-family: 'Russo One', sans-serif;
        border: 2px solid rgb(0, 32, 120);
        background-color: rgb(90, 0, 205);
        color:rgb(155, 155, 255);
      }
    </style>
  </head>
  
  <body>
    <!-- WRAP PAGE -->
    <div class="wrap">
      <!-- START CONTAINER -->
      <div class="container">

        <!-- HEADER -->
        <div class="row">
          <div class="col-12 text-center rounded-top ends">
            <a href="home">
              <h1 style="font-size: 300%">Friend Finder</h1>
            </a>
          </div>
        </div>

        <!-- BEGIN QUESTIONS-->
        <article class="questions scroll">

          <!-- NAME/PHOTO FORM -->
          <section class="row">
            <div class="col-11 col-md-6 col-lg-4 question">
              <h4>About Me</h4>
              <form id="needs-validation" novalidate>
                <div class="form-group">
                  <label for="name-input">Full Name (Required)</label>
                  <input type="text" class="form-control" id="name-input" placeholder="Name" required>
                  <div class="invalid-feedback">
                    Please provide a valid name.
                  </div>
                </div>
                <div class="form-group">
                  <label for="name-input">Short Bio (Required)</label>
                  <input type="text" class="form-control" id="bio-input" placeholder="About me" required>
                  <div class="invalid-feedback">
                    Please tell us a little bit about yourself.
                  </div>
                </div>
                <div class="form-group">
                  <label for="photo-input">Photo Link (Required)</label>
                  <input type="text" class="form-control" id="photo-input" placeholder="Photo URL" required>
                  <div class="invalid-feedback">
                    Please provide a valid photo URL. <br>
                    (.jpeg .jpg .gif .png)
                  </div>
                </div>
              </form>
            </div>
          </section>

          <!-- QUESTION 1 -->
          <section class="row">
            <div class="col-12 question">
              <h6>QUESTION 1</h6>
              <h6>I have a vivid imagination.</h6>
              <select class="rounded choices">
                <option value="" disabled selected>Select an Option</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>
          </section>

          <!-- QUESTION 2 -->
          <section class="row">
            <div class="col-12 question">
              <h6>QUESTION 2</h6>
              <h6>I like to solve complex problems.</h6>
              <select class="rounded choices">
                <option value="" disabled selected>Select an Option</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>
          </section>

          <!-- QUESTION 3 -->
          <section class="row">
            <div class="col-12 question">
              <h6>QUESTION 3</h6>
              <h6>I warm up quickly to others.</h6>
              <select class="rounded choices">
                <option value="" disabled selected>Select an Option</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>
          </section>
    
          <!-- QUESTION 4 -->
          <section class="row">
            <div class="col-12 question">
              <h6>QUESTION 4</h6>
              <h6>I like to get involved in intellectual debates.</h6>
              <select class="rounded choices">
                <option value="" disabled selected>Select an Option</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>
          </section>

          <!-- QUESTION 5 -->
          <section class="row">
            <div class="col-12 question">
              <h6>QUESTION 5</h6>
              <h6>I have a strong sense of adventure.</h6>
              <select class="rounded choices">
                <option value="" disabled selected>Select an Option</option>
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
              </select>
            </div>
          </section>
        <!-- END QUESTIONS-->
        </article>
        
        <!-- SUBMIT -->
        <div class="row">
          <div class="col-12 text-center rounded-bottom ends">
            <h3> Search for friends with common traits!</h3>
            <a class="btn btn-primary find" href="#" role="button" style="margin-bottom: 10px">FIND!</a>
          </div>
        </div>

        <!-- MODAL -->
        <div class="modal fade" id="friendModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Top Friend</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <img class="friend-img img-fluid rounded" src="#">
                <h5   class="friend-name"></h5>
                <h5   class="friend-rank"></h5>
                <h5   class="friend-bio"></h5>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>

        <!-- LINKS -->
        <a href="/api/friends" target = "_blank">API Friends list</a> | <a href="https://github.com/arinarooji/friend-finder" target = "_blank">Github Repo</a>

      <!-- END CONTAINER -->
      </div>
    <!-- END WRAP --> 
    </div>
    
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
    <!-- JavaScript -->
    <script type="text/javascript">

      //Display form's input validity (name/bio/photo), updated on every input received (purely aesthetic)
      //Takes an input element and isPhoto (true/false)
      DisplayInputValidity($('#name-input'), false);
      DisplayInputValidity($('#bio-input'), false);
      DisplayInputValidity($('#photo-input'), true);
      
      //.find button click event
      $(".find").on("click", () => {
        event.preventDefault();
        var validated = false;

        //Reference the submitted input values
        var username = $("#name-input").val().trim();
        var userbio = $("#bio-input").val().trim();
        var userphoto = $("#photo-input").val().trim();
        //Push each dropdown value to choices[]
        var choices = [];
        $('.choices').each(function(index, obj) { choices.push($(this).val()); });

        //Validation stage 1: About Me section
        //Interrogate username, userbio, and userphoto for empty values.
        //Also interrogate userphoto for absent file extensions (does not check if it is an actual image)
        if (username === "" || userbio === "" || userphoto === "" || !userphoto.match(/\.(jpeg|jpg|gif|png)$/))
        return alert("Please complete the About Me section");

        //Validation stage 2: Questions section
        //At this point, About Me has been validated. If incomplete it would return the alert. Else, check choices[]
        //Iterate through choices[], interrogate each choice for anything other than integer values from 1-5.
        else {
          choices.forEach(choice => {
            //If the iterated choice is anything other than an integer from 1-5, throw the alert and stop the program from proceeding.
            if (isNaN(parseInt(choice)) || parseInt(choice) < 1 || parseInt(choice) > 5) throw alert("Please complete the questionnaire");
            else validated = true; //Else, the choice is now validated
          })
        }

        //Validation stage 3: Object creation & POST
        //If validated makes it out of the forEach loop as true, the user's info submission is validated
        if (validated) {
          //Create the newUser object
          var newUser = { name: username, bio: userbio, photo: userphoto, scores: choices }

          //Post validated user to this route
          $.post("/api/friends", newUser)
          //When the post is done...
          .done( data => {

            //Reset About Me and all dropdowns
            $("#name-input, #bio-input, #photo-input").val("");
            $("select").each(function() { this.selectedIndex = 0 });

            //Update modal with top friend data (if rank === 0, it is an exact match. Zero differences.)
            $(".friend-img").attr("src", data.friend.photo);
            $(".friend-name").html(data.friend.name);
            $(".friend-bio").html(data.friend.bio);
            (data.rank === 0)? $(".friend-rank").html("Rank: " + data.rank + " (Exact match!)") : $(".friend-rank").html("Rank: " + data.rank)
            
            $('#friendModal').modal('show'); //Display modal
          });

        }

      }); //End of .find button click event

      //DisplayInputValidity: (purely aesthetic)
      //Takes an HTML input element and true/false value for isPhoto (checks for image file extensions if true)
      //If empty or missing extentions, adds is-invalid class and removes is-valid. Else, add is-valid class and remove is-invalid.
      //The is-valid/ is-invalid classes merely affect the input fields and do not actually prevent info submission
      function DisplayInputValidity(element, isPhoto) {
        $(element).on("input", () => {
          var inputField = $(element).val().trim();

          if ( inputField === "") { 
            $(element).addClass("is-invalid"); $(element).removeClass("is-valid");
          }
          else if (isPhoto && !inputField.match(/\.(jpeg|jpg|gif|png)$/)) { 
            $(element).addClass("is-invalid"); $(element).removeClass("is-valid");
          }
          else { $(element).addClass("is-valid"); $(element).removeClass("is-invalid"); }

        });
      }
    </script>

  </body>
</html>